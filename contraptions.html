<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html><head><meta http-equiv="content-type" content="text/html; charset=utf-8"/><meta name="viewport" content="width=device-width, initial-scale=0.8"/><title>4&nbsp;Run, contraptions!</title><link rel="stylesheet" type="text/css" href="scribble.css" title="default"/><link rel="stylesheet" type="text/css" href="racket.css" title="default"/><link rel="stylesheet" type="text/css" href="manual-style.css" title="default"/><link rel="stylesheet" type="text/css" href="manual-racket.css" title="default"/><link rel="stylesheet" type="text/css" href="custom.css" title="default"/><script type="text/javascript" src="scribble-common.js"></script><script type="text/javascript" src="manual-racket.js"></script><!--[if IE 6]><style type="text/css">.SIEHidden { overflow: hidden; }</style><![endif]--><link rel="shortcut icon" type="image/png" href="https://res.cloudinary.com/kdr2/image/upload/img-kdr2-com/main/k-favicon.png"/></head><body id="scribble-racket-lang-org"><div class="tocset"><div class="tocview"><div class="tocviewlist tocviewlisttopspace"><div class="tocviewtitle"><table cellspacing="0" cellpadding="0"><tr><td style="width: 1em;"><a href="javascript:void(0);" title="Expand/Collapse" class="tocviewtoggle" onclick="TocviewToggle(this,&quot;tocview_0&quot;);">&#9660;</a></td><td></td><td><a href="index.html" class="tocviewlink" data-pltdoc="x">He who doesn&rsquo;t blend in.</a></td></tr></table></div><div class="tocviewsublisttop" style="display: block;" id="tocview_0"><table cellspacing="0" cellpadding="0"><tr><td align="right">1&nbsp;</td><td><a href="preface.html" class="tocviewlink" data-pltdoc="x">Preface</a></td></tr><tr><td align="right">2&nbsp;</td><td><a href="whims.html" class="tocviewlink" data-pltdoc="x">Spark, whims!</a></td></tr><tr><td align="right">3&nbsp;</td><td><a href="essays.html" class="tocviewlink" data-pltdoc="x">Fly, the unchained!</a></td></tr><tr><td align="right">4&nbsp;</td><td><a href="" class="tocviewselflink" data-pltdoc="x">Run, contraptions!</a></td></tr><tr><td align="right">5&nbsp;</td><td><a href="josh.html" class="tocviewlink" data-pltdoc="x">Shine, Josh!</a></td></tr><tr><td align="right">6&nbsp;</td><td><a href="appendices.html" class="tocviewlink" data-pltdoc="x">Appendices</a></td></tr></table></div></div><div class="tocviewlist"><table cellspacing="0" cellpadding="0"><tr><td style="width: 1em;"><a href="javascript:void(0);" title="Expand/Collapse" class="tocviewtoggle" onclick="TocviewToggle(this,&quot;tocview_1&quot;);">&#9658;</a></td><td>4&nbsp;</td><td><a href="" class="tocviewselflink" data-pltdoc="x">Run, contraptions!</a></td></tr></table><div class="tocviewsublistbottom" style="display: none;" id="tocview_1"><table cellspacing="0" cellpadding="0"><tr><td align="right">4.1&nbsp;</td><td><a href="#%28part._.How_to_type_.German_and_.Spanish_characters%29" class="tocviewlink" data-pltdoc="x">How to type German and Spanish characters</a></td></tr><tr><td align="right">4.2&nbsp;</td><td><a href="#%28part._.Avoid_blurry_rendering_of_.S.V.G_paths_in_.Chromium%29" class="tocviewlink" data-pltdoc="x">Avoid blurry rendering of SVG paths in Chromium</a></td></tr><tr><td align="right">4.3&nbsp;</td><td><a href="#%28part._.Exporting_and_.Restoring_data_from_.Apache.D.S%29" class="tocviewlink" data-pltdoc="x">Exporting and Restoring data from Apache<span class="mywbr"> &nbsp;</span>DS</a></td></tr></table></div></div></div><div class="tocsub"><div class="tocsubtitle">On this page:</div><table class="tocsublist" cellspacing="0"><tr><td><span class="tocsublinknumber">4.1<tt>&nbsp;</tt></span><a href="#%28part._.How_to_type_.German_and_.Spanish_characters%29" class="tocsubseclink" data-pltdoc="x">How to type German and Spanish characters</a></td></tr><tr><td><span class="tocsublinknumber">4.2<tt>&nbsp;</tt></span><a href="#%28part._.Avoid_blurry_rendering_of_.S.V.G_paths_in_.Chromium%29" class="tocsubseclink" data-pltdoc="x">Avoid blurry rendering of SVG paths in Chromium</a></td></tr><tr><td><span class="tocsublinknumber">4.3<tt>&nbsp;</tt></span><a href="#%28part._.Exporting_and_.Restoring_data_from_.Apache.D.S%29" class="tocsubseclink" data-pltdoc="x">Exporting and Restoring data from Apache<span class="mywbr"> &nbsp;</span>DS</a></td></tr></table></div></div><div class="maincolumn"><div class="main"><div class="versionbox"><span class="version">8.5</span></div><div class="navsettop"><span class="navleft"><div class="nosearchform"></div>&nbsp;&nbsp;<span class="tocsettoggle">&nbsp;&nbsp;<a href="javascript:void(0);" title="show/hide table of contents" onclick="TocsetToggle();">contents</a></span></span><span class="navright">&nbsp;&nbsp;<a href="essays.html" title="backward to &quot;3 Fly, the unchained!&quot;" data-pltdoc="x">&larr; prev</a>&nbsp;&nbsp;<a href="index.html" title="up to &quot;He who doesn't blend in.&quot;" data-pltdoc="x">up</a>&nbsp;&nbsp;<a href="josh.html" title="forward to &quot;5 Shine, Josh!&quot;" data-pltdoc="x">next &rarr;</a></span>&nbsp;</div><h3>4<tt>&nbsp;</tt><a name="(part._contraptions)"></a>Run, contraptions!</h3><p>Our surroundings are increasingly complex today, filled with intricate
contraptions(e.g., hardware and software) that have become
ubiquitous. While many of these contraptions are unnecessarily
complicated, some do offer benefits in terms of productivity and
mental challenge.</p><p>This chapter is a collection of descriptions of various aspect of
these contraptions.</p><h4>4.1<tt>&nbsp;</tt><a name="(part._.How_to_type_.German_and_.Spanish_characters)"></a>How to type German and Spanish characters</h4><p>Now, I am learning Espa&#241;ol(Spanish) and Deutsch(German). There are
many special characters in these two languages, like accents and
umlauts. So I spent a little time to find out how to type these
characters on all my computers, and below are what I&rsquo;ve gotten.</p><h5>4.1.1<tt>&nbsp;</tt><a name="(part._.Windows)"></a>Windows</h5><p>I use Windows 11. First I setup the keyboard layout to use my right
<code class="inline-code">Alt</code> key as a <code class="inline-code">Alt Gr</code> key:</p><p>Start -&gt; Settings -&gt; Time &amp; Language -&gt; Language -&gt; Preferred Language
-&gt; Click on "English" (click "add a language" if there&rsquo;s no English in
the list) -&gt; Click "Options" on the "English" item -&gt; Click "Add a
keyboard" then select <span style="font-weight: bold">United States - International</span>.</p><p>After I&rsquo;ve done that, I got an <span style="font-weight: bold">ENG-INTL</span> input method. By
switching to this input method, I can do:</p><ul><li><p>To insert &#223;, press <code class="inline-code">RAlt+s</code></p></li><li><p>For umlauts, e.g. &#252;, press <code class="inline-code">" u</code></p></li><li><p>For accents, e.g. &#225;, press <code class="inline-code">' a</code></p></li><li><p>For &#241;, press <code class="inline-code">Shift+&#8203; n</code></p></li><li><p>For &#191;, press <code class="inline-code">RAlt+/</code></p></li><li><p>For &#161;, press <code class="inline-code">RAlt+1</code></p></li><li><p>For &rsquo;, ", and ~, press the corresponding key then press <code class="inline-code">Space</code></p></li></ul><h5>4.1.2<tt>&nbsp;</tt><a name="(part._.Linux)"></a>Linux</h5><p>Run <code class="inline-code">setxkbmap -layout us -option compose:ralt</code> to set the Right
Alt key as the compose key, then:</p><ul><li><p>To insert &#223;, press <code class="inline-code">RAlt s s</code></p></li><li><p>For umlauts, e.g. &#252;, press <code class="inline-code">RAlt " u</code> or <code class="inline-code">RAlt+" u</code></p></li><li><p>For accents, e.g. &#225;, press <code class="inline-code">RAlt ' a</code> or <code class="inline-code">RAlt+' a</code></p></li><li><p>For &#241;, press <code class="inline-code">RAlt Shift+~ n</code> or <code class="inline-code">RAlt+Shift+~ n</code></p></li><li><p>For &#191;, press <code class="inline-code">RAlt ? ?</code></p></li><li><p>For &#161;, press <code class="inline-code">RAlt ! !</code></p></li></ul><h5>4.1.3<tt>&nbsp;</tt><a name="(part._mac.O.S)"></a>macOS</h5><ul><li><p>To insert &#223;, press <code class="inline-code">Option+s</code></p></li><li><p>For umlauts, e.g. &#228;, press <code class="inline-code">Option+u a</code></p></li><li><p>For accents, e.g. &#225;, press <code class="inline-code">Option+e a</code></p></li><li><p>For &#241;, press <code class="inline-code">Option+n n</code></p></li><li><p>For &#191;, press <code class="inline-code">Option+?</code>, i.e. <code class="inline-code">Option+Shift+/</code></p></li><li><p>For &#161;, press <code class="inline-code">Option+1</code></p></li></ul><h4>4.2<tt>&nbsp;</tt><a name="(part._.Avoid_blurry_rendering_of_.S.V.G_paths_in_.Chromium)"></a>Avoid blurry rendering of SVG paths in Chromium</h4><p>[2019-11-04]</p><p>In the past few days, I am on a project of rendering PDF files to SVG
files. After some hard work, I finally managed to implement the
renderer, though some features, like translucent images, were not well
supported.</p><p>With my PDF to SVG renderer, I conveniently got many perfect SVG files
from a testing PDF file set. Yeah, these SVG files were perfect when I
viewed them with Firefox, Inkscape, or even gThumb. But soon I found
when I viewed them with Chromium, some of them are not that perfect. A
few characters were too blur to recognize.</p><p>This image is a screenshot of Firefox:</p><p><a href="https://res.cloudinary.com/kdr2/image/upload/img-kdr2-com/2019/11/SVG-Text-Path-Firefox.png" target="_blank"><img src="https://res.cloudinary.com/kdr2/image/upload/c_scale,w_400/img-kdr2-com/2019/11/SVG-Text-Path-Firefox.png" style="width: auto; height: auto; max-width: 100%;"></img></a></p><p>And this is the same file in Chromium:</p><p><a href="https://res.cloudinary.com/kdr2/image/upload/img-kdr2-com/2019/11/SVG-Text-Path-Chromium.png" target="_blank"><img src="https://res.cloudinary.com/kdr2/image/upload/c_scale,w_400/img-kdr2-com/2019/11/SVG-Text-Path-Chromium.png" style="width: auto; height: auto; max-width: 100%;"></img></a></p><p>I&rsquo;d better fix this as the Chromium (and Chrome) is the most popular
browser nowadays. I tried many vain approaches, like trying any
possible value of the <span class="RktSym">shape-rendering</span><span class="RktMeta"></span> attribute for the SVG
files, and none of them worked.</p><p>I didn&rsquo;t know how Chromium renders SVG, but I saw that in the blurrily
rendered SVG file, not all of the characters were murky. So, I thought
if I could finger out the difference of the SVG elements which
contained the clear characters and the murky characters, I would get
the reason. It proved a successful try. I found the murky characters
were in <span class="RktSym">path</span><span class="RktMeta"></span> SVG elements who had a very large value for their
<span class="RktSym">d</span><span class="RktMeta"></span> attribute while the clear ones were in elements with small
<span class="RktSym">d</span><span class="RktMeta"></span> attribute.</p><p>There must be a threshold of the size of <span class="RktSym">d</span><span class="RktMeta"></span> attribute, if a
<span class="RktSym">path</span><span class="RktMeta"></span> element has a value of <span class="RktSym">d</span><span class="RktMeta"></span> larger than it, Chromium
will render that path blurrily. But, instead of going to find that
threshold, I fix my problem empirically: I broke paths represented
long texts into smaller paths corresponding to short texts. In my
case, it is fine to regard text with <span style="font-weight: bold">less than 6 Chinese
characters</span> as short text.</p><h4>4.3<tt>&nbsp;</tt><a name="(part._.Exporting_and_.Restoring_data_from_.Apache.D.S)"></a>Exporting and Restoring data from ApacheDS</h4><p>[2018-12-25]</p><p>I am using <a href="http://directory.apache.org/apacheds/">ApacheDS</a> as the LDAP server and find I should export the data
out from it or restore the exported data into it under some
circumstances:</p><ul><li><p>When the data is corrupted thus while we are able to read the
data but we can&rsquo;t write new data into it.</p></li><li><p>When we want to back up the data and possibly restore it in the
future.</p></li></ul><p>Though <a href="http://directory.apache.org/apacheds/">ApacheDS</a> provides a desktop application based on Eclipse RCP, the
<a href="https://directory.apache.org/studio/">Apache Directory Studio</a>, to manage the <a href="http://directory.apache.org/apacheds/">ApacheDS</a> server and the data in it, it doesn&rsquo;t
provide a tool to do this automatically. So we could resort to the
commands in the <code class="inline-code">ldap-utils</code> package. This package offers many
commands to interact with a LDAP server, includes:</p><ul><li><p>ldapadd</p></li><li><p>ldapcompare</p></li><li><p>ldapdelete</p></li><li><p>ldapexop</p></li><li><p>ldapmodify</p></li><li><p>ldapmodrdn</p></li><li><p>ldappasswd</p></li><li><p>ldapsearch</p></li><li><p>ldapurl</p></li><li><p>ldapwhoami</p></li></ul><p>To resolve our problems, we can use <code class="inline-code">ldapsearch</code> to export the data,
and <code class="inline-code">ldapadd</code> to restore the data.</p><p>To export the data, it is quite straightforward:</p><p><pre class="code-block">
ldapsearch -LLL -h localhost -p 10389\
           -D "uid=admin,ou=system" -w secrete \
           -b "dc=example,dc=com" -s sub "(ObjectClass=*)" &gt;data.ldif</pre></p><p>With <code class="inline-code">-LLL</code> we tell <code class="inline-code">ldapsearch</code> to display data in the
LDIF(LDAP Data Interchange Format) format, then we give the host and
port of the server, the bind DN and the password of the user, the
search base and the search scope, and finally an attribute filter
which will match all the nodes to the command. To store the exported
data, we redirect the stdout of the command to a file at the end of
the command.</p><p>The data is now successfully exported, but before talking about how to
restore it, let&rsquo;s recall what we did while setting up the <a href="http://directory.apache.org/apacheds/">ApacheDS</a> server:</p><ol><li><p>Download it, unzip it, start it.</p></li><li><p>Create a partition, using <a href="https://directory.apache.org/studio/">Apache Directory Studio</a> is the easiest way to do
it.</p></li><li><p>Restart the server to make the new partition ready.</p></li><li><p>Update the system settings of the server if needed.</p></li><li><p>Create our own schema(commonly, attribute types and object
classes).</p></li></ol><p>Before restoring the exported data, we should set up a new server
instance by these steps first. Then we can do the restoring using
<code class="inline-code">ladpadd</code> like this:</p><p><pre class="code-block">ldapadd -h 127.0.0.1 -p 10389 \
        -D "uid=admin,ou=system" -w secret \
        -f /path/to/data.ldif -c</pre></p><p>But many errors will be encountered while running this command. Inside
the <a href="http://directory.apache.org/apacheds/">ApacheDS</a> server, the data is organized as trees. So a parent node must
be specified while creating a new node. This requires that the parent
node of a certain node must have been restored while it is going to be
restored. On the other hand, the command <code class="inline-code">ldapadd</code> adds new nodes
in the order of how the nodes are stored in the LDIF file, and the
parent-fist order is not guaranteed by <code class="inline-code">ldapsearch</code>. So errors
happen when <code class="inline-code">ldapadd</code> creates nodes whose parent are not created
yet.</p><p>There are two ways to resolve this problem:</p><p>The first one is crude: We run the <code class="inline-code">ldapadd</code> command multiple
times with the option <code class="inline-code">-c</code>.</p><p>The <code class="inline-code">-c</code> option makes <code class="inline-code">ldapadd</code> run in a continuous
operation mode, when an error occurs, <code class="inline-code">ldapadd</code> reports the error
and goes on with its work instead of exiting. Here the errors include
ones like "parent node does not exist", "node already exists", and
many other kinds of errors.</p><p>The count of the times is determined by the maximum depth of the data
tree in the <a href="http://directory.apache.org/apacheds/">ApacheDS</a> server. For example, if our data has a max-depth
3, we should run the command 3 times. During the first time, all nodes
with depth 1 and a few other nodes will be restored. Then the node
with depth 2 and then 3. Finally, all the nodes will be restored.</p><p>The second one is a little more elegant than the first one, but still
simple: we first sort the exported data, then import it. Here is a
perl script to sort the data in the LDIF file:</p><p><pre class="code-block">#!/usr/bin/env perl

use v5.12;
use MIME::Base64;

my $all_nodes = {};
my $all_dn =[];
my $current_node = "";
my $current_dn = "";
my $dn_just_assigned = 0;

while(&lt;&gt;) {
    $current_node .= $_;
    if(m/^\s+$/) {
        $all_nodes-&gt;{$current_dn} = $current_node;
        push @$all_dn, $current_dn;
        $current_node = "";
        $current_dn = "";
        next;
    }
    if(m/^dn::?\s(.*)$/) {
        $current_dn = $1;
        $dn_just_assigned = 1;
        next;
    }
    if($dn_just_assigned) {
        $current_dn .= $1 if(m/^\s+(.+)/);
        $current_dn = decode_base64($current_dn) if index($current_dn, ",") &lt; 0;
        $dn_just_assigned = 0;
    }
}

$all_dn = [sort {length $a &lt;=&gt; length $b} @$all_dn];
print $all_nodes-&gt;{$_} foreach(@$all_dn);
</pre></p><p>Save it as <code class="inline-code">ldap-data-sorter.pl</code> and run it:</p><p><pre class="code-block">ldap-data-sorter.pl /path/to/data.ldif &gt; data-sorted.ldif</pre></p><p>Then restore the data by running the below command for only once:</p><p><pre class="code-block">ldapadd -h 127.0.0.1 -p 10389 \
        -D "uid=admin,ou=system" -w secret \
        -f /path/to/data-sorted.ldif -c</pre></p><p>If all goes well, you will have got what you want at this point.</p><p>Good luck with <a href="http://directory.apache.org/apacheds/">ApacheDS</a> and <a href="https://directory.apache.org/studio/">Apache Directory Studio</a> .</p><div class="navsetbottom"><span class="navleft"><div class="nosearchform"></div>&nbsp;&nbsp;<span class="tocsettoggle">&nbsp;&nbsp;<a href="javascript:void(0);" title="show/hide table of contents" onclick="TocsetToggle();">contents</a></span></span><span class="navright">&nbsp;&nbsp;<a href="essays.html" title="backward to &quot;3 Fly, the unchained!&quot;" data-pltdoc="x">&larr; prev</a>&nbsp;&nbsp;<a href="index.html" title="up to &quot;He who doesn't blend in.&quot;" data-pltdoc="x">up</a>&nbsp;&nbsp;<a href="josh.html" title="forward to &quot;5 Shine, Josh!&quot;" data-pltdoc="x">next &rarr;</a></span>&nbsp;</div></div></div><div id="contextindicator">&nbsp;</div></body></html>